{"version":3,"file":"index.js","sources":["index.ts"],"sourcesContent":["import {documentEventHandler} from '@sanity/functions'\n\n/**\n * Creates audit trail of all PIM sync activity.\n * Tracks successful writes for monitoring and debugging.\n *\n * In production, this could:\n * - Write to a pimSyncLog document for dashboard visibility\n * - Send to external monitoring (DataDog, New Relic, etc.)\n * - Trigger Slack notifications for failed syncs\n * - Update analytics/metrics\n */\n\ninterface SyncableDocument {\n  _id: string\n  _type: string\n  sku?: string\n  pimMetadata?: {\n    syncSource?: string\n    syncStatus?: string\n  }\n}\n\nexport const handler = documentEventHandler(async ({event}) => {\n  const document = event.data?.data || event.data\n  const operation = event.type\n\n  if (!document || !document._type) {\n    return\n  }\n\n  const syncableTypes = ['product', 'productPricing', 'storeLocation']\n  if (!syncableTypes.includes(document._type)) {\n    return\n  }\n\n  if (!['document.create', 'document.update'].includes(operation)) {\n    return\n  }\n\n  const doc = document as SyncableDocument\n\n  const logEntry = {\n    timestamp: new Date().toISOString(),\n    operation,\n    documentType: doc._type,\n    documentId: doc._id,\n    sku: doc.sku,\n    syncSource: doc.pimMetadata?.syncSource || 'unknown',\n    syncStatus: doc.pimMetadata?.syncStatus || 'unknown',\n  }\n\n  console.log('[SYNC AUDIT]', JSON.stringify(logEntry, null, 2))\n})\n"],"names":[],"mappings":";AAuBO,MAAM,UAAU,qBAAqB,OAAO,EAAC,YAAW;AAC7D,QAAM,WAAW,MAAM,MAAM,QAAQ,MAAM;AAC3C,QAAM,YAAY,MAAM;AAExB,MAAI,CAAC,YAAY,CAAC,SAAS,OAAO;AAChC;AAAA,EACF;AAEA,QAAM,gBAAgB,CAAC,WAAW,kBAAkB,eAAe;AACnE,MAAI,CAAC,cAAc,SAAS,SAAS,KAAK,GAAG;AAC3C;AAAA,EACF;AAEA,MAAI,CAAC,CAAC,mBAAmB,iBAAiB,EAAE,SAAS,SAAS,GAAG;AAC/D;AAAA,EACF;AAEA,QAAM,MAAM;AAEZ,QAAM,WAAW;AAAA,IACf,YAAW,oBAAI,KAAA,GAAO,YAAA;AAAA,IACtB;AAAA,IACA,cAAc,IAAI;AAAA,IAClB,YAAY,IAAI;AAAA,IAChB,KAAK,IAAI;AAAA,IACT,YAAY,IAAI,aAAa,cAAc;AAAA,IAC3C,YAAY,IAAI,aAAa,cAAc;AAAA,EAAA;AAG7C,UAAQ,IAAI,gBAAgB,KAAK,UAAU,UAAU,MAAM,CAAC,CAAC;AAC/D,CAAC;"}